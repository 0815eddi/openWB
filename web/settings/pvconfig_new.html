<!DOCTYPE html>
<html lang="de">

	<head>
		<base href="/openWB/web/">

		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>openWB Einstellungen</title>
		<meta name="description" content="Control your charge" />
		<meta name="author" content="Kevin Wieland, Michael Ortenstein" />
		<!-- Favicons (created with http://realfavicongenerator.net/)-->
		<link rel="apple-touch-icon" sizes="57x57" href="img/favicons/apple-touch-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="img/favicons/apple-touch-icon-60x60.png">
		<link rel="icon" type="image/png" href="img/favicons/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="img/favicons/favicon-16x16.png" sizes="16x16">
		<link rel="manifest" href="manifest.json">
		<link rel="shortcut icon" href="img/favicons/favicon.ico">
		<meta name="msapplication-TileColor" content="#00a8ff">
		<meta name="msapplication-config" content="img/favicons/browserconfig.xml">
		<meta name="theme-color" content="#ffffff">

		<!-- Bootstrap -->
		<link rel="stylesheet" type="text/css" href="css/bootstrap-4.4.1/bootstrap.min.css">
		<!-- Normalize -->
		<link rel="stylesheet" type="text/css" href="css/normalize-8.0.1.css">
		<!-- include settings-style -->
		<link rel="stylesheet" type="text/css" href="settings/settings_style.css?ver=20200416-a">

		<!-- important scripts to be loaded -->
		<script src="js/jquery-3.4.1.min.js"></script>
		<script src="js/bootstrap-4.4.1/bootstrap.bundle.min.js"></script>
	</head>

	<body>

		<div id="nav"></div> <!-- placeholder for navbar -->

		<div role="main" class="container" style="margin-top:20px">

			<h1>Einstellungen für PV-Laden</h1>

			<div class="card">
				<div class="card-header font-weight-bold">
    				Allgemeine Einstellungen
  				</div>
				<div class="card-body">
					<h6>Einschaltschwelle</h6>
					<div>
						<small>
							Paramter in Watt [W] für das Einschalten der Laderegelung.
							Steigt die <b>Einspeisung</b> über die Einschaltschwelle, startet die Laderegelung.
						</small>
					</div>
					<div class="row form-group mt-1">
						<div class="col-4 col-sm-3 col-lg-2">
							<input id="minFeedinPowerBeforeStart" class="form-control integerNumber" type="number" min="0" max="100000" default="1320">
						</div>
						<label for="minFeedinPowerBeforeStart" class="col col-form-label"><small>{0 - 100000 ganzzahlig}</small></label>
					</div>
					<h6>Einschaltverzögerung</h6>
					<div>
						<small>
							Paramter in Sekunden [s] für die Verzögerung bis Ladebeginn.
							Die Ladung startet erst, wenn für die hier eingestellte Zeit die <b>Einspeisung dauerhaft</b> über der Einschaltschwelle liegt.
							Fällt die Einspeisung innerhalb der Zeitspanne unter die Einschaltschwelle, zählt die Zeit von vorne.
						</small>
					</div>
					<div class="row form-group mt-1">
						<div class="col-4 col-sm-3 col-lg-2">
							<input id="startDelay" class="form-control integerNumber" type="number" min="0" max="2400" default="10">
						</div>
						<label for="startDelay" class="col col-form-label"><small>{0 - 2400 ganzzahlig}</small></label>
					</div>
					<h6>Abschaltschwelle</h6>
					<div>
						<small>
							Paramter in Watt [W] für das Ausschalten der Laderegelung.
							Steigt der <b>Bezug</b> über die Abschaltschwelle, stoppt die Laderegelung.
						</small>
					</div>
					<div class="row form-group mt-1">
						<div class="col-4 col-sm-3 col-lg-2">
							<input id="maxPowerConsumptionBeforeStop" class="form-control integerNumber" type="number" min="0" max="100000" default="1320">
						</div>
						<label for="minFeedinPowerBeforeStart" class="col col-form-label"><small>{0 - 100000 ganzzahlig}</small></label>
					</div>
					<h6>Abschaltverzögerung</h6>
					<div>
						<small>
							Paramter in Sekunden [s] für die Verzögerung bis Ladestop.
							Die Ladung stoppt erst, wenn wenn für die hier eingestellte Zeit der <b>Bezug dauerhaft</b> über der Abschaltschwelle liegt.
							Fällt der Bezug innerhalb der Zeitspanne unter die Abschaltschwelle, zählt die Zeit von vorne.
						</small>
					</div>
					<div class="row form-group mt-1">
						<div class="col-4 col-sm-3 col-lg-2">
							<input id="stopDelay" class="form-control integerNumber" type="number" min="0" max="2400" default="10">
						</div>
						<label for="stopDelay" class="col col-form-label"><small>{0 - 2400 ganzzahlig}</small></label>
					</div>
					<h6>Mindeststromstärke</h6>
					<div>
						<small>
							Paramter in Ampere [A] für den minimalen Strom.
							Definiert den minimalen Ladestrom am Ladepunkt. Der kleinste einstellbare Wert liegt aus technischen Gründen bei 6 A.
						</small>
					</div>
					<div class="row form-group mt-1 mb-0 vaRow">
						<label for="minCurrentLp1" class="col-3 col-sm-2 col-form-label">LP1:</label>
						<div class="col-4">
							<input type="range" class="form-control-range rangeInput" id="minCurrentLp1" min="6" max="16" step="1" value="6" default="6">
						</div>
						<label for="minCurrentLp1" class="col col-form-label valueLabel" suffix="A">6 A</label>
					</div>
					<div class="row form-group vaRow">
						<label for="minCurrentLp2" class="col-3 col-sm-2 col-form-label">LP2:</label>
						<div class="col-4">
							<input type="range" class="form-control-range rangeInput" id="minCurrentLp2" min="6" max="16" step="1" value="6" default="6">
						</div>
						<label for="minCurrentLp2" class="col col-form-label valueLabel" suffix="A">6 A</label>
					</div>
					<h6>Maximalstromstärke</h6>
					<div>
						<small>
							Paramter in Ampere [A] für den maximalen Strom.
							Definiert den maximalen Ladestrom an den Ladepunkten. Der größte einstellbare Wert liegt aus technischen Gründen bei 32 A.
						</small>
					</div>
					<div class="row form-group mt-1 vaRow">
						<label for="maxEVSECurrentAllowed" class="col-3 col-sm-2 col-form-label">alle LP:</label>
						<div class="col-4">
							<input type="range" class="form-control-range rangeInput" id="maxEVSECurrentAllowed" min="11" max="32" step="1" value="32" default="32">
						</div>
						<label for="maxEVSECurrentAllowed" class="col col-form-label valueLabel" suffix="A">32 A</label>
					</div>
					<h6>Sub-Lademodus</h6>
					<div>
						<small>
							Auswahl des Sub-Lademodus bei PV-Ladung.
							Definiert den Sub-Lademodus. Die Auswahl beeinflusst den Regelpunkt und die Berechnung des Ladestroms.
						</small>
					</div>
					<div class="row form-group mt-1">
						<div class="col btn-group btn-group-toggle" data-toggle="buttons">
							<label class="btn btn-outline-secondary btn-toggle active">
								<input type="radio" name="chargeSubmode" id="optionFeedIn" autocomplete="off" checked> Einspeisung
							</label>
							<label class="btn btn-outline-secondary btn-toggle">
								<input type="radio" name="chargeSubmode" id="optionConsume" autocomplete="off"> Bezug
							</label>
							<label class="btn btn-outline-secondary btn-toggle">
								<input type="radio" name="chargeSubmode" id="optionManual" autocomplete="off"> manueller Regelpunkt
							</label>
						</div>
					</div>
					<h6>manueller Regelpunkt</h6>
					<div>
						<small>
							Paramter in Watt [W] für den manuellen Regelpunkt.
							Dieser Parameter ist nur wirksam bei der Einstellung "manueller Regelpunkt".
							Die dem EV zur Verfügung stehende Ladeleistung berechnet sich bei dieser Option aus der Differenz zwischen der Einspeiseleistung und dem eingegebenen Wert.
						</small>
					</div>
					<div class="form-group row mt-1">
						<div class="col-4 col-sm-3 col-lg-2">
							<input id="regulationPoint" class="form-control" type="number" min="-50000" max="50000" default="0">
						</div>
						<label for="regulationPoint" class="col col-form-label"><small>{-50000 - 50000 ganzzahlig}</small></label>
					</div>
				</div>  <!-- end card body Allgemeine Einstellungen -->
			</div>  <!-- end card Allgemeine Einstellungen -->

			<br>

			<div class="card">
				<div class="card-header font-weight-bold">
					EV-SoC-Ladung
				</div>
				<div class="card-body">
					<p class="card-text">Diese Funktion ist nur aktiv, wenn ausschließlich LP1 konfiguriert ist und ein SoC-Modul eingestellt wurde.</p>
					<h6>Mindest-SoC</h6>
					<div>
						<small>
							Paramter in Prozent [%] für den Mindest-SoC am LP1.
							Definiert einen EV-Mindest-SoC, bis zu dem <b>unabhängig von der PV-Leistung immer</b> geladen wird. Der Wert 0 schaltet die Funktion aus.
						</small>
					</div>
					<div class="form-group row vaRow">
						<label for="minSocAlwaysToChargeTo" class="col-3 col-sm-2 col-form-label">LP1:</label>
						<div class="col-4">
							<input type="range" class="form-control-range rangeInput" id="minSocAlwaysToChargeTo" min="0" max="80" step="5" value="0" default="0">
						</div>
						<label for="minSocAlwaysToChargeTo" class="col col-form-label valueLabel" suffix="%">0 %</label>
					</div>
					<h6>Mindest-SoC-Stromstärke</h6>
					<div>
						<small>
							Paramter in Ampere [A] für den minimalen Strom.
							Definiert den minimalen Ladestrom am Ladepunkt bis zur Erreichung des Mindest-SoC. Der kleinste einstellbare Wert liegt aus technischen Gründen bei 6 A, der größte bei 32 A.
						</small>
					</div>
					<div class="form-group row mt-1 mb-0 vaRow">
						<label for="minSocAlwaysToChargeToCurrent" class="col-3 col-sm-2 col-form-label">LP1:</label>
						<div class="col-4">
							<input type="range" class="form-control-range rangeInput" id="minSocAlwaysToChargeToCurrent" min="6" max="32" step="1" value="6" default="6">
						</div>
						<label for="minSocAlwaysToChargeToCurrent" class="col col-form-label valueLabel" suffix="A">6 A</label>
					</div>
					<h6>Maximal-SoC</h6>
					<div>
						<small>
							Paramter in Prozent [%] für den Maximal-SoC am LP1.
							Definiert einen EV-Maximal-SoC, bis zu höchstens geladen wird.
						</small>
					</div>
					<div class="form-group row vaRow">
						<label for="maxSocToChargeTo" class="col-3 col-sm-2 col-form-label">LP1:</label>
						<div class="col-4">
							<input type="range" class="form-control-range rangeInput" id="maxSocToChargeTo" min="50" max="100" step="5" value="100" default="100">
						</div>
						<label for="maxSocToChargeTo" class="col col-form-label valueLabel" suffix="%">100 %</label>
					</div>
				</div>  <!-- end card body EV-SoC-Steuerung -->
			</div>  <!-- end card EV-SoC-Steuerung -->

			<br>

			<div class="card">
				<div class="card-header font-weight-bold">
					Speicher-Beachtung
				</div>
				<div class="card-body">
					<p class="card-text">Diese Funktion ist nur aktiv, wenn ein Speicher konfiguriert wurde.</p>
					<h6>Vorrang-Steuerung</h6>
					<div>
						<small>
							Auswahl des Vorrang-Modus.
							Bei Speichervorrang wird die Ladung des Speichers vorrangig vor der EV-Ladung geregelt.
							Bei EV-Vorrang wird ungeachtet des Speicher-SoC die Ladung des EV vorrangig geregelt.
						</small>
					</div>
					<div class="row form-group mt-1">
						<div class="col btn-group btn-group-toggle" data-toggle="buttons">
							<label class="btn btn-outline-secondary btn-toggle active">
								<input type="radio" name="priorityMode" id="batteryPriority" autocomplete="off" checked> Speichervorrang
							</label>
							<label class="btn btn-outline-secondary btn-toggle">
								<input type="radio" name="priorityMode" id="evPriority" autocomplete="off"> EV-Vorrang
							</label>
						</div>
					</div>
					<h6>Anzeige</h6>
					<div>
						<small>
							Auswahl der Vorrang-Anzeige.
							In einigen Themes kann die Anzeige des gewählten Vorrang-Modes angezeigt oder versteckt werden.
						</small>
					</div>
					<div class="row form-group mt-1">
						<div class="col btn-group btn-group-toggle" data-toggle="buttons">
							<label class="btn btn-outline-secondary btn-toggle active">
								<input type="radio" name="boolShowPriorityIconInTheme" id="showPriority" autocomplete="off" checked> anzeigen
							</label>
							<label class="btn btn-outline-secondary btn-toggle">
								<input type="radio" name="boolShowPriorityIconInTheme" id="hidePriority" autocomplete="off"> nicht anzeigen
							</label>
						</div>
					</div>

Speicher Mindestladeleistung


					<h6>Speicher-Entlade-SoC</h6>
					<div>
						<small>
							Paramter in Prozent [%] für den minimalen Soeicher-SoC.
							Definiert einen minimalen Speicher-SoC, bis zu dem ein Speicher höchstens entladen wird. Der Wert 100 schaltet die Funktion aus.
						</small>
					</div>
					<div class="form-group row vaRow">
						<label for="maxSocToChargeTo" class="col-3 col-sm-2 col-form-label">LP1:</label>
						<div class="col-4">
							<input type="range" class="form-control-range rangeInput" id="maxSocToChargeTo" min="50" max="100" step="5" value="100" default="100">
						</div>
						<label for="maxSocToChargeTo" class="col col-form-label valueLabel" suffix="%">100 %</label>
					</div>


				</div>  <!-- end card Speicher-Beachtung -->
			</div>  <!-- end card Speicher-Beachtung -->


		</div>  <!-- container -->

		<footer class="footer bg-dark text-light font-small">
			<div class="container text-center">
				<small>Sie befinden sich hier: Ladeeinstellungen/PV-Laden</small>
			</div>
		</footer>

		<!-- load mqtt library -->
		<script src = "js/mqttws31.js" ></script>
		<!-- load topics -->
		<script src = "settings/topicsToSubscribe_pvconfig.js?ver=20200415-a" ></script>
		<!-- load service -->
		<script src = "settings/setupMqttServices.js?ver=20200415-a" ></script>
		<!-- load mqtt handler-->
		<script src = "settings/processAllMqttMsg_pvconfig.js?ver=20200415-a" ></script>

		<script type="text/javascript">

			$.get('settings/navbar.html', function(data){
				$('#nav').replaceWith(data);
				// disable navbar entry for current page
				$('#navPvLaden2').addClass('disabled');
			});

			$(document).ready(function(){

				$('.rangeInput').on('input', function() {
					// show slider value in label of class valueLabel
					var label = $('label[for="' + $(this).attr('id') + '"].valueLabel');
					if ( label.length == 1 ) {
						var suffix = $(label).attr('suffix');
						var text = this.value;
						if ( suffix != '' ) {
							text += ' ' + suffix;
						}
						$(label).text(text);
					}
				});

				$('input.integerNumber').on('input', function() {
					//integer and max input value validation
					this.value = this.value.replace(/[^0-9.]/g,'').replace(/(\..*)\./g, '$1');
					if ( parseInt(this.value) > $(this).attr('max') ) {
						this.value = $(this).attr('max');
					}
				});

			});  // end document ready function


		</script>

	</body>
</html>
